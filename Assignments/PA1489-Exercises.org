#+Title: PA1489 √ñvningsuppgifter
#+Author: Mikael Svahnberg
#+Email: Mikael.Svahnberg@bth.se
#+Date: 2024-04-19
#+EPRESENT_FRAME_LEVEL: 1
#+OPTIONS: email:t <:t todo:t f:t ':t H:2 toc:nil
#+STARTUP: beamer

#+LATEX_CLASS_OPTIONS: [10pt,t,a4paper]
#+BEAMER_THEME: BTH_msv

* Introduktion
Det h√§r dokumentet sammanfattar de /icke betygsgivande/ √∂vningsuppgifter som introduceras under varje f√∂rel√§sning.
* Kom ig√•ng med din IDE
- Starta =IntelliJ IDEA= eller den IDE du har valt (e.g. =VS Code= eller =VS Codium=) .
- Skapa ett Projekt =New Project= (Finns kanske inte som ett val i =VS Code=) 
  - Name: =TestProjekt=
  - Language: =Java=
  - =Create=

Vad ser du nu? 
Vad ser du i kod-f√∂nstret?
Vad betyder symbolerna? ‚ñ∂Ô∏èüõëüí°‚ö†Ô∏è

Hur k√∂r du programmet?
Vad h√§nder?

Hur k√∂r du programmet i debug-l√§ge?
Vad h√§nder nu? Hur g√•r du vidare?
** Redigera Main.java
- L√§gg till en metod i klassen, =public static int addTen(int x)=
  - Skriv metoden ovanf√∂r main-funktionen (mellan rad 3 och 4)
  - Den skall l√§gga till 10 till =x= och returnera detta
- L√§gg till raden ~System.out.println("i+10 = " + addTen(i));~
- K√∂r programmet nu. Vad h√§nder?

IntelliJ f√∂rs√∂ker hela tiden ge dig ledtr√•dar p√• vad du kan skiva. 
- Hur ser detta ut?
- Vad f√•r du f√∂r hj√§lp?
- Hj√§lper det faktiskt, eller √§r det i v√§gen?

#+begin_src java
public class Main {

    public static void main(String[] args) {
        System.out.printf("Hello and welcome!");
    }
}
#+end_src
** Hj√§lp i IntelliJ
- St√§ll dig n√•gonstans d√§r det st√•r ~println~ och tryck =ctrl-Q= ("Quick Documentation" i IntelliJ)
  - Du kan ocks√• komma √•t detta via =View= -menyn. Vad mer kan du hitta d√§r?

- Hur g√∂r du motsvarande i VSCode?
** L√§gg till en ny klass
- =File/New/Java Class= eller =File/New File=
- Name: =Nummer=
- Skriv in f√∂ljande kod efter rad 1:
#+begin_src java
public class Nummer {
  private int myNumber=0;

  public Nummer(int x) {
    myNumber = x;
  }

  public boolean smallerThan(int x) {
    return (myNumber < x);
  }

  public int get() {
    return myNumber;
  }

  public String toString() {
    return "Number: " + myNumber;
  }
}
#+end_src

** Anv√§nd den nya klassen
- Byt tillbaka till =Main.java= och l√§gg till f√∂ljande kod efter rad 12:
#+begin_src java
  Nummer num = new Nummer(10);
  System.out.println("Is "+ num + " smaller than 12: " + num.smallerThan(12));
#+end_src

Vilken "hj√§lp" f√•r du n√§r du skriver detta?
Hur kan du k√∂ra det h√§r programmet utan att str√§cka dig efter musen?

F√∂rsta raden av utskriften blir: =Hello and welcome!Is Number: 10 smaller than 12: true=
- Hur kan du fixa s√• att du f√•r en ny rad efter "welcome!"?
- Vad kan du g√∂ra f√∂r att bara skriva ut siffran 10 och inte "Number: 10"?
** G√∂r editorn din
- M√•ste allt synas samtidigt? Hur g√∂mmer du undan saker?
- Gillar du inte f√§rgschemat? Hur byter du?

- Det finns gott om plugins. =File/Settings/Plugins=
  - Vilka vill du installera? Vilka √§r redan installerade?
** Hitta Terminalen
- Det finns en inbyggd kommandoradstolk. Var d√•?
- Vad kan du g√∂ra med den?

* Kom Ig√•ng med Git
** Registrera ett Konto
- M√•ste tyv√§rr b√∂rja med att registrera ett konto p√• n√•gon server.
  - https://github.com/signup eller https://education.github.com/pack
  - https://gitlab.com/users/sign_up
  - https://www.atlassian.com/software/bitbucket/bundle
  - https://codeberg.org/

- Github √§r fortfarande v√§ldigt stort f√∂r open source-projekt
  - Lite i bl√•sv√§der f√∂r hur de anv√§nder koden som du laddar upp dit
- M√•nga migrerade √∂ver till Gitlab n√§r Microsoft k√∂pte Github
- Atlassian och Bitbucket har bra integration med deras √∂vriga produkter.
  - Brukade vara v√§ldigt gener√∂sa f√∂r studenter och universitet (numera vet jag inte)
- Codeberg.org √§r specifikt fokuserat p√• open-source-projekt

** Skapa och klona ett Repository
- L√§ttast att b√∂rja i webgr√§nssnittet
- D√∂p projektet till n√•got kreativt, t.ex. =gitexempel=
- N√§r du √§r klar b√∂r du kunna hitta en l√§nk, t.ex. under =<> Code= som du kan anv√§nda f√∂r att klona projektet
  - till exempel: ~git clone https://codeberg.org/mickesv/gitex.git~
  - Det h√§r s√§tter up =remote/origin= mm. √•t dig.
** Skapa lite git-historia
1. Skapa n√•gra filer
2. L√§gg till dem till stashen och committa
3. √Ñndra n√•gon av filerna; l√§gg till och committa igen
4. Upprepa n√•gra g√•nger
5. Skapa en branch
6. Skapa n√•gra filer, l√§gg till och committa.
7. Redigera n√•gon av dina f√∂rsta filer, committa.
8. Kolla loggen
9. Kolla status
10. Pusha till servern
11. Kolla status
** Forka en kollegas repository
1. Leta r√§tt p√• en kollegas konto (p√• samma server)
2. V√§lj ett repository och forka det (L√§mpligen exempel-kontot som ni nyss skapade)
3. Klona ner det till din dator och skapa lite mer git-historia
4. N√§r du har pushat allt till din fork, skapa en =pull request= hos deras repository (via webben)
** Hantera en pull request
N√§r din kollega har skapat en pull request mot ditt repo, hantera den:
- Inspektera commit f√∂r commit vad som √§r √§ndrat
- G√•r den att merga automatiskt? Det borde st√• n√•gonstans.
- Skapa en merge commit.

Skapa n√•gra fler commits i era respektive forkar
- Skapa en ny pull request
- Den h√§r g√•ngen skall ni /neka/ pull requesten.
** Fler deltagare i samma projekt
- Dela in er i grupper om ca 5 personer
- V√§lj en kollegas repository
- G√• till =Settings/Collaborators= och l√§gg till fler av er p√• samma projekt.
- Klona repot

Nu f√•r ni bara arbeta i en viss fil =charlie-foxtrot.txt=
- Ni f√•r skriva ny text
- Ni f√•r redigera texten som finns d√§r
- Ni f√•r stoppa in text: mellan tv√• rader, och mitt i en rad.
- Ni f√•r ta bort text

Committa regelbundet (max 2-3 √§ndringar per commit)
Pusha efter varje commit
- Ni kan beh√∂va g√∂ra en =fetch/merge= f√∂r att f√• g√∂ra en =push=

*hantera merge-konflikterna*

Diskutera i sm√• grupper: Hur skall ni g√∂ra f√∂r att f√• f√§rre konflikter?
* Testning och Debugging
** Introduktion till SorterTool
- https://codeberg.org/mickesv/SorterTool.git
- /SorterTool/ implementerar och testar ett par olika sorteringsalgoritmer.
- Det finns m√•nga olika s√§tt att sortera listor p√• som √§r olika snabba.
  - S√∂k p√• "Sorting out Sorting" f√∂r en gammal film (30 min) fr√•n 1980 som vi tvingades titta p√• i Datastruktur-kursen.
  - "Big-O" notation beskriver komplexiteten hos algoritmer.
- Exempel:
  - Insertion Sort: =O(n¬≤)= Flytta element ur v√§gen och stoppa in elementet p√• r√§tt plats
  - Selection Sort: =O(n¬≤)= Hitta det minsta v√§rdet och stoppa in det f√∂rst; b√∂rja om p√• element 2
  - Merge Sort: =O(n*log n)= Se till att varje par √§r ordnade, kombinera par =n= med =n+1=; upprepa.
  - QuickSort: =O(n*log n)=
    1. V√§lj ett element i mitten
    2. se till att alla till v√§nster √§r mindre och alla till h√∂ger st√∂rre
    3. upprepa f√∂r v√§nster och h√∂ger.
  - Bubble Sort: =O(n¬≤)= j√§mf√∂r varje element med alla andra och byt plats p√• alla element som inte redan √§r ordnade.
** Kom ig√•ng med √∂vningen
1. Klona SorterTool till din dator: https://codeberg.org/mickesv/SorterTool.git
2. √ñppna projektet i din IDE. Studera f√∂ljande filer:
   - ~src/Main.java~ f√∂r att snabbt kunna k√∂ra programmet
   - ~src/Sorter.java~ implementerar de olika sorteringsalgoritmerna.
   - ~Tests/SorterTest.java~ testar ~Sorter~.
3. K√∂r alla tester. Vad h√§nder?
4. K√∂r specifikt testet f√∂r ~bubbleSort()~
** Skaffa mer information

*L√§s meddelandet*

Nej, allvarligt! *L√§s meddelandet!*

- Vad kan ~AssertionFailedError~ betyda?
- I vilken fil och p√• vilken rad h√§nder det?
- Vad st√•r det p√• den raden?
  - R√§cker detta f√∂r att f√∂rst√• vad som gick fel?
  - Hur kan du ta reda p√• mer informaiton?
** Anv√§nd Debuggern
1. I filen ~SorterTest.java~, klicka p√• radnummret =56= ( =assertTrue(isOrdered(out))= ) Det borde bytas till en liten stopp-skylt üõë
2. K√∂r nu testet f√∂r ~bubbleSort()~ i "Debug"-l√§ge.

Vad ser du nu i:
- kodf√∂nstret?
- f√∂nstret nedanf√∂r koden?

** Debug-f√∂nstret
[[./Debugging-annotated.png]]
- H√§r kan vi se varf√∂r testet misslyckas, men inte vad i koden som orsakade felet.
- /Ledtr√•d:/ Titta p√• arrayen ~out~ och alla v√§rden d√§r. Kan du se n√•got m√∂nster?
** Stega genom koden
1. Flytta break-punkten fr√•mn rad =56= till rad =54=  ( ~int [] out = srt.bubbleSort(testArray)~ ).
2. K√∂r testet f√∂r ~bubbleSort()~ igen i Debug-l√§ge (Starta om testet n√§r du f√•r fr√•gan).

Viktiga verktyg f√∂r att stega genom koden:
- Continue/Resume :: K√∂r p√• till n√§sta breakpoint
- Step over :: K√∂r n√§sta instruktion, och stanna n√§r du kommer tillbaka
- Step in :: F√∂lj med in i n√§sta instruktion (oftast in i en metod)
- Step out :: K√∂r klart metoden du √§r i nu, och stanna n√§r du kommer tillbaka.

Anv√§nd *Step in* nu f√∂r att stega in i anropet till =srt.bubbleSort()= .
- Notera att variabelf√∂nstret √§ndras. Vad ser du d√§r nu? Varf√∂r?

Stega ett par varv i den inre for-loopen.
- raderna med ~for~ och ~if~ k√∂rs i varje varv.
- N√§r forts√§tter koden in i if-satsen? 
  - Vid vilka v√§rden p√• ~out[outer]~ respektive ~out[inner]~ ?

St√§mmer detta? (Det g√∂r det inte. Vad borde h√§nda?)

R√§tta till felet och forts√§tt debugga.
- Som du m√§rker verkar inte √§ndringen fungera.
- Du m√•ste /starta om/ testet f√∂r att det skall ta effekt.
** K√∂r om alla tester
- N√§r du nu har fixat felet s√• borde alla tester bli gr√∂na.
- Varf√∂r blir b√•de ~sort()~ och ~bubbleSort()~ gr√∂na? Du har ju bara fixat ~bubbleSort()~\dots
** Lek vidare p√• egen hand
- Kan du anv√§nda debuggern f√∂r att f√∂rst√• hur sorteringsalgoritmerna fungerar?
- Skriv din egen sorteringsalgoritm och testa den.
- Just nu finns det ett test f√∂r varje metod. Kan du ha fler tester f√∂r varje metod?
  - Vilka fler tester kan vara relevanta?
* Dokumentation
** Introduktion till JavaPonies
- /Desktop Ponies/ √§r en urgammal mono-applikation (liknar Visual Basic) som l√•ter My Little Ponies springa runt p√• sk√§rmen.
- /Java Ponies/ √§r "min" version av detta program  
  - https://codeberg.org/mickesv/JavaPonies.git
  - Varning:
    - Det √§r l√•ngt ifr√•n f√§rdigt
    - Det √§r inte fulst√§ndigt dokumenterat
    - Det √§r l√•ngsamt och s√§kert buggigt
  - Men:
    - PONIES

#+ATTR_LATEX: :width 100px
[[./fly_rainbow_right-0.png]]
** Kom ig√•ng med √∂vningen
1. Klona projektet till din dator: https://codeberg.org/mickesv/JavaPonies.git
2. √ñppna projektet i din IDE och studera programmet s√• att du f√∂rst√•r vad det g√∂r.
   - ~src/JavaPonies.java~ startar programmet
   - ~src/model/Pony.java~ Implementerar en klass som instantieras f√∂r varje ponny
   - ~src/model/PonyBehaviour.java~ representerar ett enskilt beteende som en ponny kan ha
   - ~src/view/PonyWindow.java~ Sk√∂ter visning och uppdatering av en viss ponny som √§r aktiv p√• sk√§rmen.
** Skapa dokumentationen
- Fr√•n en terminal: ~javadoc src/*.java src/model/*.java src/view/*.java -d doc~
- Fr√•n IntelliJ: =Tools/Generate JavaDoc=, fyll i att dokumentationen skall hamna i katalogen ~doc~
  (Resultatet √∂ppnas i din webl√§sare)

Inspektera dokumentationen:
- J√§mf√∂r med vad du ser i java-filerna
- Vad finns med? Vad finns inte med?
- N√§r du skapade dokumentationen fick du m√•nga varningar. Vad beror de p√•?

** Uppdatera JavaDoc
Filen ~src/model/PonyBehaviour.java~ saknar JavaDoc-kommentarer.

1. Skriv dessa kommentarer s√• att du inte l√§ngre f√•r n√•gra javadoc-varningar fr√•n ~PonyBehaviour.java~.
2. √ñkade detta anv√§ndbarheten av dokumentationen? Varf√∂r / Varf√∂r inte?
3. √ñkade detta l√§sbarheten av koden? Varf√∂r/Varf√∂r inte?
** Skapa en Issue
Notera:
- Om du har ett konto p√• Codeberg.org kan du skapa en issue direkt mot JavaPonies-projektet
- Om du inte har eller inte vill ha ett konto kan du skriva din issue direkt i en textfil.

Att G√∂ra:
1. Hitta n√•gonting att √•tg√§rda i projektet. Det kan vara en:
   - Bug -- n√•got som inte fungerar som f√∂rv√§ntat
   - Enhancement -- en ny feature
2. Skriv din issue. Den skall inneh√•lla:
   - Kort men inneh√•llsrik titel
   - Beskrivande text
   - Steg f√∂r att provocera fram buggen, eller steg till d√§r f√∂rb√§ttringsf√∂rslaget skulle kunna vara l√§mpligt
   - F√∂rv√§ntat resultat
   - Faktiskt resultat
   - √ñvrig information (om relevant)
** F√∂rb√§ttra en metod
1. V√§lj en metod eller attribyt som du tycker √§r otydlig och genomf√∂r en /Refactoring/ s√• att den blir tydligare.
   - IntelliJ har en hel meny f√∂r Refactor; utforska den f√∂r att se vad som finns d√§r och hur det fungerar

Fundera p√•:
- Vilket st√∂d har du av din IDE f√∂r Refactoring?
- Hj√§lper detta st√∂det?
- Hur vet du vad som √§r en bra refactoring?
* Implementation i Java
** Mera Ponies
- Vi forts√§tter med JavaPonies.
- MLP-fansen har best√§llt ett ut√∂kat gr√§nssnitt d√§r man kan f√• reda p√• mer data om varje Ponny.
- Vi skall dessutom se till att p√•b√∂rja implementationen av /Interactions/, att en ponny byter beteende f√∂r att de √§r n√§ra n√•gon annan.

** MLP-Data
1. Skriv ett interface ~src/model/PonyStatistics.java~ enligt nedan.
2. Se till att ~model.Pony~ implementerar detta interface. Notera att
   - N√•gra metoder redan finns, men kan beh√∂va ut√∂kas
   - N√•gra metoder kommer kanske anropas flera g√•nger; s√§rskilt ~load()~ kommer beh√∂va ta h√§nsyn till detta.
   - Nya klasser kan beh√∂va skapas t.ex. f√∂r att inneh√•lla en Interaction
   - N√•gra av get-metoderna kan beh√∂va iterera √∂ver en ~ArrayList<>~ av t.ex. ~Behaviours~ f√∂r att plocka fram deras namn och spara i en String-array.
   - Vi inte har n√•got s√§tt att anv√§nda dessa metoder √§nnu. /Skriv g√§rna enhetstester i st√§llet./

#+begin_src plantuml :file mlp-ponystats.png
interface PonyStatistics {
+void load()
+String getName()
+Path getDefaultImagePath()
+String[] getCategories()
+String[] getBehaviourGroups()
+String[] getBehaviourNames()
+String[] getEffectNames()
+String[] getSpeakLines()
+String[] getInteractionNames()
}
#+end_src

#+RESULTS:
[[file:mlp-ponystats.png]]
** Interactions
- F√∂r att en Ponny skall kunna interagera med en annan Ponny, s√• kr√§vs det att de vet att de st√•r i n√§rheten av varandra.
- Detta kan inte en enskild Ponny veta. Vilka andra alternativ har vi?
  - ~view.PonyWindow~ vet var en viss Ponny √§r (genom att fr√•ga den), men inte de andra.
  - ~view.MainWindow~ har, n√§r den skapat ~PonyCard~ f√∂r varje ~Pony~, inte ens koll p√• vilka Ponnys som finns.
  - ~model.PonyContainer~ kan veta. Men d√• f√•r den tv√• ansvarsoms√•den: Underh√•lla samlingen av Ponnys /och/ sk√∂ta interaktioner.

\sum 
1. Vi beh√∂ver skapa en ny klass ~model.InteractionManager~, som har en samling med ~InteractionEntity~
   - Metoden ~maybeStartInteraction()~ beh√∂ver anropas regelbundet
2. Vi beh√∂ver skapa ett interface ~model.InteractionEntity~ som ~Pony~ implementerar
   - S√§rskilt viktig √§r metoden ~maybeStartInteraction()~
3. Vi beh√∂ver skapa en klass ~model.PonyInteraction~ som representerar en specifik m√∂jlig interaktion.
4. Klassen ~JavaPonies~ beh√∂ver "s√§tta ig√•ng" ett ~InteractionManager~ - objekt.
5. Klassen ~view.PonyWindow~ beh√∂ver samarbeta med ~model.Pony~ s√• att ~model.Pony~ vet om den √§r synlig eller inte.

#+begin_src plantuml :file mlp-ponyinteraction.png

class InteractionManager {
-List<InteractionEntity> myInteractionEntities
+void addEntity(InteractionEntity theEntity)
+void maybeStartInteraction()
-List<InteractionEntity> getVisibleEntities()
}


InteractionManager - "*" InteractionEntity

interface InteractionEntity {
+void load()
+boolean isVisible()
+String getName()
+int getX()
+int getY()
+void maybeStartInteraction(List<InteractionEntity> visibleEntities);
}

InteractionEntity <|-- Pony

Pony - "*" PonyInteraction

class PonyInteraction {
-String name
-float chance
-int proximityPixels
-String[] targetNames
-enum Targetactivation targetActivation
-String[] behaviourNames
-int cooloffDelay
+String getName()
+String getPossibleInteractionName(int xPosition, int yPosition, List<InteractionEntity> entitiesToCheck)
+int getCooloffDelay()
-String getRandomBehaviour()
}


#+end_src

#+RESULTS:
[[file:mlp-ponyinteraction.png]]

* Grafiska Gr√§nssnitt i Java
** Mera Pony-Statistik
- I projektet JavaPonies finns en branch =PonyStatistics= d√§r interfacet fr√•n tidigare f√∂rel√§sningar implementeras.
- Checka ut JavaPonies p√• ett nytt st√§lle (om du vill spara din implementation) och byt branch:
  - ~git clone https://codeberg.org/mickesv/JavaPonies.git~
  - ~cd JavaPonies && git checkout PonyStatistics~
- Kontrollera vad som √§ndrats: ~git diff origin/main~
** En Ny Main
1. Skriv en ny klass ~JavaPonyStatistics extends JavaPonies~
  (att √§rva fr√•n JavaPonies g√∂r att du kan spara mycket av uppstarten fr√•n JavaPonies).
2. Skriv en ny ~main()~ - funktion i ~JavaPonyStatistics~ :

#+begin_src java
	public static void main(String[] args) {
		JavaPonyStatistics ps = new JavaPonyStatistics();
		ps.printStatistics();
	}
#+end_src

3. [@3] Implementera metoden ~JavaPonyStatistics.printStatistics() s√• att den:
   - itererar √∂ver alla Ponies (du hittar dem via ~myPonies.findAll()~ ), och 
   - skriver ut Categories, Behaviour Groups, Behaviours, Effects, Interactions, och Speakig Lines:

#+begin_verse
Printing Statistics for Apple Bloom
Categories:
Behaviour Groups:
Behaviours: stand, walk, follow_aj, spin_me_right_round, workout, aww, CMC, dance
Effects:
Interactions:
Speaking lines:
- CUTIE MARK CRUSADER DESKTOP PONIES!!!
- Did I get my cutie mark? Did I? Did I!?
- Scoot-Scootalooo!
- Aww!
- Aren't you gonna stay for brunch?
- But I want it now!
- I am a big pony!
- I'm not a baby, I can take care of myself!
- Likely story.
- Not the cupcakes!
- Some pony needs to put this thing out of its misery.
- You're not using power tools, are you?
- Scootaloo! Scoot-Scootaloo!
- Trust me.
- What a thing to say!
#+end_verse
** Bara en enda Pony
Notera signaturen f√∂r main: ~public static void main(String [] args)~
- public :: s√• att man kommer √•t den utanf√∂r klassen
- static :: s√• att man inte beh√∂ver f√∂rst skapa ett objekt
- void :: man kan inte returnera n√•got
- main :: s√• att runtime-java vet vilken metod den skall leta efter
- String [] args :: H√§r kommer alla kommandorads-parametrar.

Dags att l√§gga till lite interaktivitet:
1. Om ~(0 == args.length)~ , lista statistik f√∂r alla ponies (som tidigare)
2. Annars, hitta alla ponies som inneh√•ller ~arg[0]~.
   - Du kommer vilja se till att allting √§r antingen stora eller sm√• bokst√§ver: ~String::toLowerCase()~ .
   - Det r√§cker att veta om ponnyns namn /inneh√•ller/ str√§ngen, anv√§nd ~String::contains()~ .
   - ~pony.getName().toLowerCase().contains(arg[0].toLowerCase())~
** Ett Grafiskt Gr√§nssnitt
1. Skriv en ny klass ~view/PonyStatisticsViewer~ som skapar en JFrame enligt nedan.
2. Skriv en funktion f√∂r att fylla listan med namnen p√• alla tillg√§ngliga Ponies.
3. Skriv kod s√• att n√§r man har valt en Pony och trycker p√• knappen "View Statistics", s√• visas statistiken till h√∂ger.
4. V√§nta med "Save to file..." - knappen.

#+begin_src plantuml :file PonyStatsViewer.png
@startsalt
!theme bluegray

{^
{
<b>Pony Statistics Viewer
}
{^"Available Ponies"
{SI
Rainbow Dash
Pinkie Pie
<b>Applejack
Twilight
.
.
.
.
.
.
"                              "
}
[View Statistics] 
} | {^"Pony Statistics"
 Name |             "Applejack           "
 Behaviour Groups | "                    "
 Behaviours |       "stand, walk, gidd..."
 Effects |          "Apple Drop, tree_..."
 Interactions |     "                    "
 .
 Speaking Lines | {SI
  Hey there, Sugarcube!
  Howdy, Partner!
  I better get buckin' soon.
  Yeee...
  Haw!
}
. | [Save to file...]
}
}



#+end_src

#+RESULTS:
[[file:PonyStatsViewer.png]]

** Save to File...
Nu √§r det dags att implementera "Save to file...":

1. N√§r man trycker p√• knappen skall en ~javax.swing.JFileChooser~ √∂ppnas.
2. Statistiken om den valda Ponyn skall sedan skrivas till den angivna filen.
3. Kontrollera att filen har r√§tt inneh√•ll genom att √∂ppna den (eller visa den i din terminal)

*** MWE for Save to File
#+begin_src java
import javax.swing.*;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import javax.swing.filechooser.FileSystemView;

public class FiCH {

public static void main(String [] args) {
	JFrame f = new JFrame("FiCH");
	f.setSize(500, 500);
	f.setVisible(true);
	JLabel l = new JLabel("no file selected");

	JButton button1 = new JButton("save");  
  button1.addActionListener(new ActionListener() {
      public void actionPerformed(ActionEvent evt) {
				JFileChooser j = new JFileChooser(FileSystemView.getFileSystemView().getHomeDirectory());
				int result = j.showSaveDialog(f);
				if (result == JFileChooser.APPROVE_OPTION) {
					l.setText(j.getSelectedFile().getAbsolutePath());
				} else {
					l.setText("the user cancelled the operation");
        }
			} });
 
	JPanel p = new JPanel();
	p.add(button1);
	p.add(l);
	f.add(p);	
}
}
#+end_src

* Virtuella Maskiner och Containers
** Kom ig√•ng med n√•gra tutorials
1. Docker https://docs.docker.com/get-started/
2. Docker with node.js  https://docs.docker.com/language/nodejs/
** Om Projektet: QuoteFinder
- Ladda ner Projektet: https://github.com/mickesv/ProvisioningDeployment.git
  - √Ñr egentligen en del av en kurs i /Applied Cloud Computing and Big Data/
  - Var lugn, vi kommer inte anv√§nda allt i den h√§r kursen.

- /QuoteFinder/ letar efter citat i texter.
  - Tre versioner
    - Version 1, Letar efter en hel str√§ng
    - Version 2 && 3 letar efter orden n√§ra varandra.
    - Version 1 :: Enklare, g√•r att k√∂ra n√§stan ensamt.
    - Version 2 && 3 best√•r av ett antal kommunicerande microservices.
  - Skrivet i Javascript / node.js https://nodejs.org/ (ett tolkat spr√•k)
  - Express web app http://expressjs.com/
  - Anv√§nder ocks√• socket.io https://socket.io/ 
  - Kopplar upp sig mot en MongoDB-databas https://www.mongodb.com/
  - Exponerar tre websidor: ~/~ , ~/add~ , och ~/list~ .

#+begin_src artist
  +----------------------+                    +--------------------+---------------+
  | Web Client           |<------------------>| QuoteFinder        | Jade/Pug      |
  +----------------------+   Socket.io        |                    | Page Rendering|
                             and              +--------------------+---------------+
                             HTTP             | simpleTextManager  |         
                                              |                    |
                                              +---------+----------+
                                                        |      
                                              +---------+----------+
                                              | MongoDB Database   |
                                              +--------------------+
#+end_src
** Kolla koden: ~Containers/Version1/QFStandalone/src/~
- L√§s igenom ~index.js~
  - Hur skapas en "route"?
  - Vad h√§nder n√§r man t.ex. beg√§r sidan ~/add~ ?  Vilken funktion anropas?

- *Ni beh√∂ver /inte/ f√∂rdjupa er om f√∂ljande*:
  - ~res.render()~ anv√§nder sig av /Jade/Pug/ f√∂r att skapa en websida: https://pugjs.org/
    - Vanligt arbetss√§tt; "l√§ttare" att skapa en websida med dynamiskt inneh√•ll fr√•n n√•got mall-system.
  - /Promises/ √§r ett s√§tt att l√§nka saker som skall h√§nda asynkront s√• att de √§nd√• sker i ordning.
    - En ledtr√•d √§r n√§r man hittar kod ~.then()~; d√• arbetar man troligen med en /Promise/.

- L√§s igenom ~simpleTextManager.js~
  - Vad g√∂r klassen / vilka metoder / vilka ansvarsomr√•den har den?
  - Titta lite n√§rmre p√• metoden ~addText()~
    - vad g√∂r den?
    - varf√∂r tror du att den sparar texterna p√• det h√§r viset?
** Bygg en image
- g√• till katalogen d√§r ~Dockerfile~ ligger, ~Containers/Version1/QFStandalone/~
- Titta p√• ~Dockerfile~, f√∂rst√•r du hur den √§r uppbyggd och vad som kommer h√§nda?
- Bygg en image: ~docker build -t qfstandalone .~ 
  - Vad h√§nder?
  - Notera hur den bygger upp lager efter lager.
- Kontrollera efter√•t att den faktiskt byggdes ~docker image ls~
  - Vilka fler images har du? Varf√∂r tror du att de finns d√§r?
** Starta applikationen: podman/docker
1. Applikationen anv√§nder =MongoDB=, s√• vi beh√∂ver h√§mta den: ~docker pull mongo~
2. Vi beh√∂ver ett n√§tverk f√∂r att qfstandalone skall kunna prata med databasen:
   - ~docker network create qfstandalone-net~
3. Starta databasen: ~docker run -d --network qfstandalone-net --network-alias textstore --name textstore mongo~
4. Starta applikationen: ~docker run -it --network qfstandalone-net -e TEXTSTORE_HOST=textstore -w /app -v ./src:/app/src --name qfstandalone -p 8080:3000 qfstandalone~ 

*F√∂rklaring: Starta Databasen*
#+begin_src bash
  docker run                  # Start a Container
  -d                          # In detached mode (in the background)
  --network qfstandalone-net  # Connect to the virtual network we just created
  --network-alias textstore   # Make this container accessible
                              # on the network using this name
  --name textstore            # Use this name when we access 
                              # the container with docker
  mongo                       # Use this image as base for the container
#+end_src

*F√∂rklaring: Starta Applikationen*
#+begin_src bash
  docker run                    # Start a container
  -it                           # In interactive mode, and attach 
                                # a terminal so we can also type into it
  --network qfstandalone-net    # Same virtual network
  -e TEXTSTORE_HOST=textstore   # Set the environment variable to the 
                                # network alias of our MongoDB database
  -w /app                       # Set the working directory inside the container
  -v ./src:/app/src             # Attach the host directory ./src 
                                # to the guest under /app/src
  --name qfstandalone           # Container name
  -p 8080:3000                  # Connect host port 8080 to 
                                # port 3000 in the container
  qfstandalone                  # Use this image (the tag we previously set)
#+end_src
** Testa
1. L√§gg till en bok, g√• till: http://localhost:8080/add
   - Anv√§nd f√∂rslagsvis en bok fr√•n Gutenberg-projektet https://www.gutenberg.org/
   - Om du inte skriver in n√•got s√• kommer du l√§gga till en textversion av Leo Tolstoy's /Krig och Fred/ 
2. G√• till http://localhost:8080/  och s√∂k efter n√•got, till exempel 'prince'.

Att g√∂ra:
- H√•ll ett √∂ga p√• din terminal. Vad skrivs ut? Vad h√§nder?
- Eftersom vi startade med flaggorna ~-it~ s√• kan vi kontrollera appen i terminalen:
  - Prova skriv =rs= och tryck p√• =<enter>= , vad h√§nder?
  - Det h√§r √§r f√∂r att vi k√∂r programmet med hj√§lp av ~nodemon~ : https://nodemon.io/

- Vi startade ocks√• programmet med en /bind mount/ : ~-v ./src:/app/src~
  - √ñppna filen ~src/index.js~ och leta r√§tt p√• metoden ~startPage()~
  - Byt ut return-raden mot ~return listTextsPage(req, res);~
  - Vad h√§nder i terminalen?
  - Ladda om startsidan i webl√§saren; du b√∂r nu ocks√• se en lista med alla tillg√§ngliga texterna.
** Avbryt, Stoppa, och St√§da upp
- Avbryt den k√∂rande applikationen genom att trycka =Ctrl-C= i terminalen.
  - Det h√§r stoppar den k√∂rande containern =qfstandalone=
  - Databas-containern =textstore= forts√§tter k√∂ra i bakgrunden
  - N√§tverket finns fortfarande tillg√§ngligt
  - Kolla vad som finns kvar: ~docker ps -a~

- Dags att rensa:
#+begin_src bash
	docker rm -f textstore qfstandalone
	docker network rm qfstandalone-net
	docker network prune -f
#+end_src
** Starta applikationen: podman/docker compose
- Vi har redan introducerat en =docker compose= -fil f√∂r att starta applikationen.
- √ñppna och studera filen ~docker-compose-v1.yml~
- Starta applikationen med ~docker compose -f docker-compose-v1.yml up~ 
- Testa som innan med http://localhost:8080/  och http://localhost:8080/add

Att g√∂ra:
- Notera hur utskrifterna i terminalen skiljer sig.
- Vad h√§nder om du skriver =rs= som innan i terminalen?
- Vad h√§nder n√§r du avbryter med =Ctrl-C= ? Kontrollera med ~docker ps -a~ 
*** √ñverkurs: kommunicera med applikationen
1. Uppdatera docker compose-filen (Se nedan)
2. I en separat terminal, koppla p√• dig p√• den k√∂rande containern:
   ~docker compose -f docker-compose-v1.yml attach app~


#+begin_src yaml
version: "3.8"
services:
  app:
    image: qfstandalone
    stdin_open: true # docker run -i
    tty: true        # docker run -t
    ports:
      - 8080:3000
    volumes:
      - ./Containers/Version1/QFStandalone/src:/app/src
    environment:
      TEXTSTORE_HOST: textstore
  textstore:
    image: mongo
    command: --quiet --syslog
    expose:
      - "27017"
#+end_src

** Sammanfattning
1. Bygg en =Image=
2. Starta en =Container=
   - Starta endast en container √•t g√•ngen
   - Starta flera containrar med ett enda kommando
3. Redigera filer lokalt och se dem √§ndras i en k√∂rande container

F√∂rdelar:
+ Kan k√∂ra vilka program och programspr√•k du vill i en container.
+ Upprepningsbar deployment.

Nackdelar:
- Kan k√∂ra vilka program och programspr√•k du vill i en container; inklusive malware.
- Det borde vara, men √§r inte, helt transparent att ta n√§sta steg ut p√• molnet.
- Databasen √§r inte persistent √§n\dots

* Utveckla med Microservices
** Introduktion: PonyVoter
- Vi stannar i Equestria, men med en enkel r√∂stningsapp den h√§r g√•ngen.
- PonyVoter presenterar tv√• alternativ √•t g√•ngen, och man r√∂star genom att klicka p√• en av dem.
- R√∂sterna r√§knas i en databas, s√• att man √∂ver tid kan se vilken ponny som √§r mest popul√§r.

Kom ig√•ng:
1. Ladda ner projektet: https://codeberg.org/mickesv/PonyVoter.git
2. Studera filerna, f√∂rs√∂k bilda din egen uppfattning om vad du har laddat ner.

#+ATTR_ORG: :width 300
[[./PonyVoter-Screenshot.png]]
** Teknisk √ñversikt
- PonyVoter best√•r av tre containers och en databas:
  - PonyVoter :: "Framsidan" p√• applikationen som servar webbsidor till anv√§ndarna
  - VoteCounter :: Registrerar r√∂ster och sparar dem till databasen
  - StatsPresenter :: R√§knar ihop hur m√•nga r√∂ster respektive ponny har och sammanfattar detta
  - MongoDB :: Databasen d√§r r√∂sterna lagras

- PonyVoter √§r hoppl√∂st √∂verdesignat och samtidigt underimplementerat
  - =VoteCounter= och =StatsPresenter= √§r extremt enkla, och hade antagligen inte beh√∂vt ha egna Containers i nul√§get.
  - Mycket √§r h√•rdkodat.
  - F√∂r att inte kr√§va f√∂r m√•nga extra resurser anv√§nds ingen renderingsmotor (s√•som =Pug= ) f√∂r att generera HTML-koden.
  - F√∂r att h√•lla projektet litet finns det bara sex ponnies att v√§lja mellan.
  - Fullst√§ndighet? Bara det allra n√∂dv√§ndigaste finns implementerat.
  - Skalbarhet, vad h√§nder n√§r det totala antalet r√∂ster √∂kar?
  - Buggar! De finns s√•klart.
  - S√§kerhet?

Fundera p√•:
1. Vilka containers skall vara tillg√§ngliga f√∂r anv√§ndaren?
2. Hur ser du till att bara dessa blir tillg√§ngliga?
3. Hur kan du starta alla containers med ett enda kommando?
** Starta och Testa
1. Filen =ponyvoter.yaml= anv√§nds av =docker compose= f√∂r att bygga och starta applikationen.
   - Hur √§r den uppbyggd?
   - Vad finns angivet f√∂r varje container?
   - √Ñr ~volumes~ - blocken n√∂dv√§ndiga? Vad g√∂r de?
   - Kan du se hur man kommer √•t respektive container?
2. Starta applikationen: ~docker compose -f ponyvoter.yaml up~
3. G√• in p√• http://localhost:8080 och testa applikationen
   - H√•ll ett √∂ga p√• terminalen n√§r du k√∂r; vad skrivs ut?
4. Avbryt genom att trycka ~Ctrl-C~ i terminalen.
   - Vad h√§nder?
   - Kolla med ~docker images~ vilka images som du har
   - Kolla med ~docker ps -a~ vilka containers som k√∂rs respektive inte l√§ngre √§r ig√•ng
5. Starta igen (samma kommando)
   - Vad h√§nder?
   - Notera att statistiken nollst√§lls inte, trots att alla containrar startats om.
     - Varf√∂r?
     - Hur kan du ta reda p√• mer om detta?
** Hitta Databasen
1. Kontrollera vilka volymer som docker har skapat =docker volume ls=
   - Det borde finnas tv√• med l√•nga icke-namn, ex. ~aa5972d833f74bc8085bafdc32aa279e45c8d29cf631355b0c00f21d06b2ac23~
   - Kan det vara dessa som √§r databasen?
   - g√•r det f√• mer information? ~docker volume inspect aa5972d833f74bc8085bafdc32aa279e45c8d29cf631355b0c00f21d06b2ac23~  
2. G√• bakv√§gen. ~docker ps -a~ visar att databasen heter ~ponyvoter-mongodb-1~
   - Vad f√•r du f√∂r information fr√•n ~docker inspect ponyvoter-mongodb-1~? 
   - Leta efter "Mounts" i utskriften, eller filtrera lite f√∂rst: ~docker inspect -f '{{.Mounts}}' ponyvoter-mongodb-1~

V√•r misstanke st√§mmer allts√•. MondoDB anv√§nder allts√• tv√• volymer:
- ~/data/configdb~ och ~/data/db~ .

Uppgift:
1. L√§s p√• om /Volumes/ i dokumentationen till docker compose.
2. Modifiera ~ponyvoter.yaml~ s√• att ~mongodb~ anv√§nder tv√• /namngivna/ volymer; =db-data= och =db-config=.
3. Rensa bort de b√•da gamla med ~docker volume prune~ .
** Skala applikationen
- Eftersom alla containers h√•ller sig till REST-principerna, s√• g√•r det enkelt att skala.
- I =ponyvoter.yaml= kan man ange hur m√•nga ~replicas~ en viss service skall ha i en viss drifts√§ttning.
  - Det √§r lite mer invecklat √§n s√•; l√§s p√• i den officiella dokumentationen f√∂rst.

Att g√∂ra
1. Uppdatera ~ponyvoter.yaml~ s√• att den drifts√§tter 3 st replicas av =votecounter=.
2. Starta om applikationen.
3. R√∂sta p√• ett antal ponnys och h√•ll koll p√• terminalen: vad h√§nder?
   - Finns det n√•gon ordning i hur dina tre replicas anv√§nds?
4. Fundera p√•:
   - Kan du √§ndra till 5 replicas /utan/ att starta om applikationen? Hur? Prova!
   - Tips 1: R√§cker det att √§ndra i yaml-filen?
   - Tips 2: =up= tar flaggan =--detach=
   - Tips 3: Du kanske inte ens beh√∂ver √§ndra i yaml-filen\dots
     - kolla vad du kan g√∂ra med ~docker compose --help~
** Erbjuda och Anv√§nda REST
Det √§r dags att titta inuti applikationen ocks√•. 

=Containers/StatsPresenter=
- Har en enda kodfil: ~src/index.js~
- Det finns i huvudsak fyra delar:
  1. Skapa en express-webserver
  2. Koppla upp mot databasen
  3. St√§ll in och s√§tt ig√•ng alla REST-√§ndpunkter som applikationen skall lyssna p√•
  4. Funktioner f√∂r varje √§ndpunkt

=Containers/VoteCounter=
- Ser i princip likadan ut.

=Containers/PonyVoter=
- Lite fler funktioner, men i stort sett samma struktur.

Att g√∂ra:
- Vilka REST-√§ndpunkter erbjuder respektive container?
- √Ñr de GET, POST, PUT, eller DELETE? Vad borde de vara?
- Vilka typer av svar ger respektive √§ndpunkt?
- Hur kan du testa det?
** Testa API:et
- Bara =PonyVoter= √§r tillg√§nglig fr√•n v√§rd-datorn\dots
- hur kan vi testa de andra containrarna?

Att g√∂ra
1. Studera =Containers/APITester= s√• att du vet vad den g√∂r.
   - Studera √§ven ~test.yaml~. 
2. Starta =PonyVoter= - applikationen
3. K√∂r ~docker compose -f test.yaml up~ och se vad som h√§nder.
   - Notera att du har tre olika typer av svar, med olika =Content-Type=.
   - Hur kan du anv√§nda detta n√§r du bygger ett REST-API?
** Fundera p√• / Ta reda p√•
- Kan du kontrollera om en container √§r frisk?
  - Hur skriver du en s√•dan /healthcheck/ i din docker compose-fil?
  - M√•ste du alltid ha en s√§rskild √§ndpunkt i ditt REST-API f√∂r detta?
    - N√§r m√•ste du definitivt ha en s√§rkskild √§ndpunkt?
    - Finns det andra l√∂sningar?

- Vissa drifts√§ttningsplatformar har begreppet /Init Containers/
  - Vad anv√§nder man init containers till?
  - Hur kan du √•stadkomma detta med docker compose?

- Vad √§r docker compose /Secrets/ ?
  - N√§r skall du anv√§nda dem?
  - Hur?

- Vad beh√∂ver du g√∂ra f√∂r att din docker compose-file
  skall bli f√§rdig att drifts√§ttas (/Production Ready/)?

** Sammanfattning
- Du har nu arbetat med en /microservice/ - applikation
- Varje komponent (Container) har sitt eget /REST-api/
- Du har anv√§nt flera olika programspr√•k (=JavaScript/Node.js= och =bash= )
- Du har skalat delar av din applikation upp och ner
* Kom ig√•ng med JavaScript
** Introduktion till √ñvningen
- Den h√§r g√•ngen skall vi b√∂rja fr√•n grunden med ett helt nytt projekt.
- Du kanske vill skapa projektet p√• din git-server f√∂rst och klona det d√§rifr√•n
  - Om inte, starta √•tminstone i en ny katalog med =git init=

- Projektet g√•r ut p√• att man f√•r fylla i f√∂rnamn och efternamn p√• en websida, och f√• en h√§lsning tillbaka.
- Som en del av projektet skall du /minst/ skapa f√∂ljande
  1. En =Dockerfile= som
     - installerar =nodemon=,
     - installerar alla √∂vriga beroenden fr√•n =package.json=, och
     - startar applikationen med =ENTRYPOINT ["npm", "run", "dev"]=.
  2. En =package.json= som minst:
     - deklarerar =Express ^4.19.1= som ett beroende
     - har ett =dev= - script som startar applikationen med hj√§lp av nodemon.
  3. En fil ~src/index.js~ som startar upp en express-webapplikation med tv√• routes
     - =GET /= som levererar en sida enligt nedan
     - =GET /greet= som l√§gger till en rad =Hello, Firstname Lastname!=.
  4. En fil och en klass =src/person.js= som
     - representerar en person med =firstname()=, =lastname()=, och =fullname()=.
     - Lagrar namnen med versal f√∂rsta bokstav (ex lagras "john" som "John")
     - Har en metod =greet()= som returnerar =this.fullname()=.
     - Gl√∂m inte =module.exports = Person=
  5. (g√§rna) en =makefile= med tv√• regler:
     - en =build= (=docker build . -t namegreeter=)
     - en =run= (=docker run -it -p8080:3000 -w /app -v ./src:/app/src namegreeter=)

#+begin_src plantuml :file NameGreeter.png
@startsalt
!theme bluegray
{+
Please Enter your name:
{
Firstname | "firstname    "
Lastname  | "lastname     "
}
[Greetings]
..
' Hello, Firstname Lastname !
}
@endsalt


#+end_src

#+RESULTS:
[[file:NameGreeter.png]]
** Spara H√§lsningar
- N√§sta steg √§r att l√§gga till en sida till =GET /list= som visar alla personer man tidigare h√§lsat p√•

Att g√∂ra
1. L√§gg till en array =previousGreetings= i index.js, som du sparar dina =Person= - objekt i.
2. L√§gg till en route till =GET /list= i =index.js= som visar alla personer fr√•n din =previousGreetings=.
** R√§kna H√§lsningar
- F√∂r varje person man h√§lsar p√•, kolla i =previousGrettings= om du har h√§lsat p√• den personen innan
  (antag att om "Firstname Lastname" √§r samma s√• √§r det samma person)
- L√§gg till en r√§knare i Person-klassen som √∂kas varje g√•ng man h√§lsar p√• den personen.
** Familjerelationer
- Om bara efternamnet st√§mmer, (och inte f√∂rnamnet) s√• √§r det en sl√§kting.
- L√§gg till metoden =addRelative(aPerson)= i din Person-klass.
  - Dubbelkolla (f√∂r s√§kerhets skull) s√• att personen inte redan √§r listad som en sl√§kting
- Fixa =GET /list= s√• att alla sl√§ktingar listas f√∂r varje person.
- Fixa =GET /list= s√• att namnen skrivs ut i bokstavsordning baserat p√• efternamnet.
** Sammanfattning
- Du har nu:
  - skrivit en enkel web-applikation i en container
  - skrivit en klass i Javascript.
  - Lagt till metoder i klassen.
  - Sparat objekt i samlingar och h√§mtat dem d√§rifr√•n.

* Applikationsutveckling med JavaScript
** Introduktion: Craic -- ett enkelt chat-program
- I den h√§r uppgiften skall vi arbeta med ett enkelt chat-program: /Craic/.
  - /Craic/ √§r ett irl√§ndskt ord f√∂r skvaller.
  - Applikationen g√•r ut p√• att man skriver sm√• korta meddelanden till varandra.
  - https://codeberg.org/mickesv/craic.git
** Utmaningar
  - S√§tta sig in i en existerande kodbas ::
    - Hellre √§n att jag g√•r igenom systemet och systemarkitekturen s√• f√•r /ni/ gl√§djen att g√∂ra det.
    - Hur k√∂r man programmet?
    - Vilka huvudsakliga komponenter finns?
    - vad g√∂r respektive modul?
  - Anv√§ndargr√§nssnitt fr√•n inuti en container ::
    - Vi hade kunnat skriva en web-klient, men vi vill ha n√•got annat
    - Textbaserat UI, s√• kallat /TUI/
** Kom ig√•ng med projektet
1. Ladda ner projektet: https://codeberg.org/mickesv/craic.git
2. S√§tt dig in i projektet
   - Hur k√∂r man programmet?
   - Vilka komponenter finns?
   - Vad g√∂r respektive modul?
3. Testk√∂r
   - Skriv n√•gra inl√§gg
   - L√§gg datormusen upp-och-ner och f√∂rs√∂k anv√§nda bara tangentbordet
     - (tips: Man beh√∂ver trycka ~<escape>~ f√∂r att l√§mna ett textf√§lt)
4. Kan du koppla upp dig mot en kollegas server? Hur?
** Uppdatera Klienten
1. L√§gg till ett textf√§lt med namnet p√• servern som skall anv√§ndas
2. Se till att den angivna servern faktiskt anv√§nds
3. Testk√∂r tillsammans med en kollega
** Uppdatera Servern
1. L√§gg till fler otill√•tna ord och namn (notera att en del √§r angivna som /Regulj√§ra Uttryck/)
2. L√§gg till en modul som g√∂r att man kan =#tagga= nyckelord och =@n√§mna= andra anv√§ndare
   - Skall de bara sparas tillf√§lligt i servern eller skall de lagras i databasen?
   - Hur s√∂ker man efter en viss =#tag=? L√§gg till det till serverns REST-API.
3. L√§gg till st√∂d f√∂r att h√§mta flera sidor av inl√§gg
   - Man beh√∂ver l√§gga till ~page=xxx~ till fr√•gan
   - Man beh√∂ver l√§gga till ~page=xxx~, och ~nextPage: yyy~ i svaret.
   - Extrapo√§ng om ni inte anv√§nder sidnummer rakt av utan r√§knar fram en nyckel i st√§llet.
     - (Att man kan lista ut sidnummer √§r ett s√§kerhetsh√•l)
  
Fundera p√•:
- Vad h√§nder om man anv√§nder ett f√∂rbjudet ord men stavar det annorlunda, t.ex. "belGIUm"?
- Hur kan du testa dina API-f√∂r√§ndringar?
- Blir det en ny major version av produkten n√§r du l√§gger till nya REST-√§ndpunkter?
- Blir det en ny major version n√§r du l√§gger till st√∂d f√∂r att h√§mta fler sidor?
- Kan du f√∂renkla servern s√• att den har en konfigurerbar lista med filter att till√§mpa, snarare √§n att de √§r h√•rdkodade?
  - Fundera p√• hur du skulle implementera detta.
** Skriv Tester
1. Planera och skriv Mocha/Chai-tester f√∂r servern
2. Planera och skriv Mocha/Chai-tester f√∂r klienten
** Skapa en web-klient
1. Skapa en ny Container som k√∂r en webklient p√• samma vis som den TUI-baserade klienten.
2. K√∂r programmet med b√•de TUI-klienten och webklienten ig√•ng samtidigt.
3. Kan du √•teranv√§nda dina tester fr√•n TUI-klienten?
** Fundera p√• REST-API:et
- Hur vet klienterna om det finns nya meddelanden?
  - Vad inneb√§r detta f√∂r servern?
- Hur kan du g√∂ra det annorlunda / sn√§llare f√∂r servern?
  - F√∂rs√∂k!
** Sammanfattning
- Med containers och moduler blir varje del av programmet ganska frist√•ende och l√§tt att anpassa.
- REST-API √§r inte lika enkelt som ett vanligt metodanrop, men n√§stan.
- Skalbarhet:
  - En egen container f√∂r att hantera =#taggar= och =@omn√§mnanden=?
  - Flera server-containrar med lastbalanserare?
- Olika typer av klienter

* Kom ig√•ng med Databaser
** Docker Compose-fil
- Vi beh√∂ver inget git-repo den h√§r g√•ngen, utan b√∂rjar med en enkel docker-compose-fil (se nedan)
  - Vad g√∂r den h√§r filen?
  - Default-anv√§ndaren heter =postgres=, men man m√•ste ange l√∂senordet.
- Starta med =docker compose= som vanligt.

#+begin_src yaml
version: '3.9'
services:
  db:
    image: postgres
    restart: always
    shm_size: 128mb
    environment:
      POSTGRES_PASSWORD: hunter2
  adminer:
    image: adminer
    restart: always
    ports:
      - 8080:8080
#+end_src
** √ñversikt om Adminer
- √ñppna en webl√§sare mot http://localhost:8080
- Vid inlogget beh√∂ver du ange
  - System :: PostreSQL
  - Server :: db (eftersom det √§r vad servern heter i docker compose-filen vi skapade)
  - Username :: postgres
  - Password :: hunter2 (eller vad du nu √§ndrade det till i docker compose-filen)

- Adminer ger dig m√∂jlighet att klicka dig fram i webl√§saren f√∂r att skapa databaser, tabeller, och v√§rden
- Du kan ocks√• skriva SQL-kommandon direkt
  - Det h√§r √§r tacksamt n√§r man skall g√∂ra st√∂rre eller upprepade operationer.

*Tips* Om du √§r God V√§n‚Ñ¢ med din editor kan du s√§kert koppla upp dig mot databasen d√§rifr√•n.

- Du beh√∂ver d√• se till att databasen √§r tillg√§nglig p√• port 5432 √§ven utanf√∂r docker-compose-klustret.
- Gl√∂m inte att "st√§nga in" den igen n√§r du har utvecklat f√§rdigt s√• att inte n√•gon utifr√•n kan hacka din databas.
** Skapa En Databas
- Vi forts√§tter med pony-extravagansan.
- Den h√§r g√•ngen vill vi bygga en databas f√∂r att kunna generera "Trading Cards"
- Vi bortser f√∂r stunden fr√•n bilder, cutie marks, och liknande och h√•ller oss till ren text.
- Databasdesignen √§r f√∂renklad; det √§r h√§r ni beh√∂ver en hel kurs om databaser bara f√∂r att f√∂rst√• hur och varf√∂r.
- *Att g√∂ra* Skapa en databas =TradingCards=.

#+ATTR_LATEX: :width 100px
[[./Twilight-front.jpg]] [[./Twilight-back.jpg]]
** Skapa Tabeller och Kolumner
1. Skapa f√∂ljande tabeller och kolumner:

#+begin_src plantuml :file pony-db.png
skinparam linetype ortho
title "Database TradingCards"
entity Pony {
 * **name** : text <<PRIMARY KEY>>
 type : text
 description : text
 harmonyElement : text
 pet : text
 location: text
}

entity PonyType {
 * **typeName** : text <<PRIMARY KEY>>
}

entity PonyGroup {
 * name : text <<NOT NULL>>
 * member : text
 description : text
}

entity Family {
 * name : text <<NOT NULL>>
 * member : text
}

entity HarmonyElement {
 * **name** : text <<PRIMARY KEY>>
}

entity Location {
 * **name** : text <<PRIMARY KEY>>
}

entity Speech {
 * **short** : text <<PRIMARY KEY>>
 line : text
 pony : text
}

Pony }o-|| PonyType
Pony }o-|| HarmonyElement
Pony }o-|| Location
Pony }o--o{ PonyGroup
Pony }o--o| Family
Pony }o--o{ Speech
#+end_src

#+RESULTS:
[[file:pony-db.png]]

** Fyll p√• med Data
1. Ladda ner filen https://codeberg.org/mickesv/gists/raw/branch/main/TradingCards_insert.sql
   - Titta igenom filen s√• att du f√∂rst√•r vad den g√∂r.
2. Leta r√§tt p√• sidan ="SQL command"= I adminer-gr√§nssnittet.
3. Klistra in filen och tryck p√• execute.
   - Om du skapade databasen korrekt skall alla =INSERT= fungera.
   - Annars, /l√§s felmeddelandet/, √•tg√§rda och f√∂rs√∂k igen.
4. Fyll p√• med n√•gra fler Ponnys, t.ex. h√§rifr√•n:
   - https://mlp.fandom.com/wiki/My_Little_Pony_Friendship_is_Magic_Wiki
** Enkla S√∂kningar
1. Anv√§nd adminer-gr√§nssnittet och g√∂r n√•gra enklare s√∂kningar.
   - Till v√§nster finns det l√§nkar =select= och =tabellnamn= f√∂r varje tabell.
   - V√§lj "select" f√∂r r√§tt tabell, och fyll i f√§lten f√∂r "Select" och "Search" s√• att du kan hitta:

| Visa f√∂ljande f√§lt | fr√•n tabellen | som matchar vilkoret           |
|--------------------+---------------+--------------------------------|
| name, type         | pony          | name √§r exakt (=) "Rarity"     |
| name, type         | pony          | name inneh√•ller (~) "Twilight" |
| member             | family        | name √§r exakt "Apple"          |
| pony, line         | speech        | pony inneh√•ller 'Rainbow'      |
|--------------------+---------------+--------------------------------|
** Kombinerade S√∂kningar
1. Fundera p√• hur du skulle uttrycka f√∂ljande fr√•gor:
   - Hitta alla Pony.name och Pony.type f√∂r Ponies som √§r med i en Family.
   - Vad kan alla Pony som befinner sig i Ponyville t√§nkas s√§ga?
   - Vad kan alla Pony som /inte/ befinner sig i Ponyville t√§nkas s√§ga, och vad heter de?
   - Hitta namnen p√• alla Ponies som n√§mns i en PonyGroup men som inte finns i tabellen Pony √§n.
2. F√∂rs√∂k st√§lla dessa fr√•gor i adminer.
   - Du kan beh√∂va anv√§nda "SQL Command" f√∂r att lyckas.
*** Facit :noexport:
#+begin_src sql
-- Hitta alla Pony.name och Pony.type f√∂r Ponies som √§r med i en Family.
SELECT Pony.name,Pony.type FROM Pony JOIN Family ON member=pony.name;

-- Vad kan alla Pony som befinner sig i Ponyville t√§nkas s√§ga?
SELECT line FROM Speech JOIN Pony ON pony=name AND location='Ponyville';

-- Vad kan alla Pony som /inte/ befinner sig i Ponyville t√§nkas s√§ga, och vad heter de?
SELECT pony,line FROM Speech JOIN Pony ON pony=name AND location!='Ponyville';

-- Hitta namnen p√• alla Ponies som n√§mns i en PonyGroup men som inte finns i tabellen Pony √§n.
SELECT PonyGroup.name,member FROM PonyGroup WHERE PonyGroup.member NOT IN (SELECT name from Pony);
#+end_src
** Hantera S√∂kningar och Resultat fr√•n Datorprogram
1. Skapa en Container 'PonyTradingCard' som s√∂ker i databasen och listar alla Ponys enligt nedanst√•ende mall.
   - Du v√§ljer sj√§lv programspr√•k. I node.js beh√∂vs paketet ="pg"= f√∂r PostgreSQL.
2. Uppdatera din docker-compose-fil s√• att den h√§r containern ocks√• k√∂rs.

#+begin_src quote
--------------------
Pony: Fluttershy
Type: Pegasus
Element of Harmony: Kindness
Pet: Angel
Description: Very shy and scared of dragons.
Location: Everfree Forest

Family Members:
- Mr. Shy
- Mrs. Shy
- Zephyr Breeze

Groups:
- Gen 4
- Main Character

Speech:
- "Oh, my."
- "I don't wanna talk about it."
- "I'd like to be a tree."
#+end_src
